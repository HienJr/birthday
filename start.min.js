const checkBtn=document.querySelector(".check");const playBtn=document.querySelector("#playBtn");const banner=document.querySelector(".banner");const question=document.querySelector(".question");const cake=document.querySelector(".cake");const image=document.querySelector(".image-wrap");const audio1=document.querySelector("#audio-1");const audio2=document.querySelector("#audio-2");const container=document.querySelector(".container");let intervalIdMatrix;const data=["09/10/2001","09/10/2025","Ch√∫c m·ª´ng tu·ªïi 24","Ch√∫c m·ª´ng sinh nh·∫≠t","‚ù§Ô∏è","Love You","L√™ Th·ªã Kim T·ªët","Tiffany","Sinh nh·∫≠t vui v·∫ª","Happy Birthday üéÇ","üòò"];const depthLayers=[{scale:.6,speed:7,opacity:.5,zIndex:1},{scale:1,speed:6,opacity:.8,zIndex:2},{scale:1.4,speed:5,opacity:1,zIndex:3}];const usedPositions=[];const screenWidth=screen.width;const screenHeight=screen.height;const isScreenPC=screenWidth>1025;function getRandomPosition(maxWidth,textWidth){let maxAttempts=50;let attempt=0;const padding=isScreenPC?80:30;while(attempt<maxAttempts){const x=Math.floor(Math.random()*(maxWidth-textWidth));let overLap=usedPositions.some(pos=>Math.abs(pos-x)<padding);if(!overLap){usedPositions.push(x);return x}attempt++}return null}function createDropText(text){const p=document.createElement("p");p.textContent=text;p.classList.add("drop-text");const layer=depthLayers[Math.floor(Math.random()*depthLayers.length)];p.style.color="white";p.style.fontSize=isScreenPC?`${24*layer.scale}px`:`${16*layer.scale}px`;p.style.animationDuration=`${layer.speed}s`;p.style.opacity=layer.opacity;p.style.zIndex=layer.zIndex;container.appendChild(p);const x=getRandomPosition(window.innerWidth,p.offsetWidth);if(x!==null){p.style.top=`-${p.offsetWidth}px`;p.style.left=`${x}px`;setTimeout(()=>{p.remove();usedPositions.splice(usedPositions.indexOf(x),1)},layer.speed*1e3)}else{p.remove()}}const dataLength=data.length;const bg=document.querySelector(".star-background");bg.style.width=screenWidth;bg.style.height=screenHeight;function createStar(){const start=document.createElement("div");start.className="star";start.style.width=`${Math.floor(Math.random()*3)+2}px`;start.style.height=`${Math.floor(Math.random()*3)+2}px`;start.style.left=`${Math.random()*screenWidth}px`;start.style.top=`${Math.random()*screenHeight}px`;start.style.animationDelay=`${Math.random()*5}s`;return start}function startDropText(){setInterval(()=>{const text=data[Math.floor(Math.random()*dataLength)];createDropText(text)});for(let i=0;i<240;i++){const start=createStar();bg.appendChild(start)}}function skew(){if(screenWidth<1025&&window.DeviceOrientationEvent){window.addEventListener("deviceorientation",e=>{const beta=e.beta;const gama=e.gamma;const angleX=Math.max(-80,Math.min(80,beta-30));const angleY=Math.max(-110,Math.min(110,gama));container.style.transform=`rotateX(${angleX}deg) rotateY(${angleY}deg)`})}}skew();class SliderImage{constructor(className){this.imgList=document.querySelector(className);if(!this.imgList){throw new Error(`Element with selector "${className}" not found.`)}this.originalSlides=Array.from(this.imgList.children);this.originalSlidesLength=this.originalSlides.length;this.slides=this.originalSlides.slice(0);if(screenWidth>1024){this.items=5}else if(screen.width>768){this.items=4}else{this.items=3}if(screenHeight<431){this.items=0}this.currentIndex=this.items;this.speed=1500;this.isAnimating=false;this.createTrack();this.updatePosition()}createTrack(){const cloneHead=this.slides.slice(-this.items).map(node=>node.cloneNode(true));const cloneTail=this.slides.slice(0,this.items).map(node=>node.cloneNode(true));this.slides=cloneHead.concat(this.slides.concat(cloneTail));this.imgList.innerHTML="";this.slides.forEach(slide=>{slide.style.width=`calc(100% / ${this.items})`;this.imgList.appendChild(slide)})}moveSlide(step){if(this.isAnimating)return;this.isAnimating=true;const length=this.slides.length;this.currentIndex+=step;setTimeout(()=>{if(this.currentIndex>=length-this.items){this.currentIndex=this.items;this.updatePosition(true)}else if(this.currentIndex<=0){this.currentIndex=this.originalSlidesLength;this.updatePosition(true)}this.isAnimating=false},this.speed);this.updatePosition()}updatePosition(instant=false){const offset=-(this.currentIndex*(100/this.items));this.imgList.style.transition=instant?"none":`transform ease ${this.speed}ms`;this.imgList.style.transform=screenHeight<769?`translate(${offset}%, -50%)`:`translateX(${offset}%)`}autoSlide(step){if(this.intervalId)clearInterval(this.intervalId);this.intervalId=setInterval(()=>{this.moveSlide(step)},this.speed)}}function sliderImage(){const top=new SliderImage(".image-top");top.autoSlide(1);const bot=new SliderImage(".image-bot");bot.autoSlide(-1)}const canvas=document.getElementById("canvas");const ctx=canvas.getContext("2d");class Confetti{constructor(x,y,directionX){this.x=x;this.y=y;this.size=Math.random()*6+3;this.color=`hsl(${Math.random()*360}, 100%, 60%)`;this.alpha=1;this.gravity=.05;this.rotation=Math.random()*Math.PI*2;this.rotationSpeed=(Math.random()-.5)*.2;const angle=directionX<x?-2.5:-.6;const speed=Math.random()*6+6;this.vx=speed*Math.cos(angle)+(directionX<x?-1:1)*Math.random()*2;this.vy=speed*Math.sin(angle)+Math.random()*-1}update(){this.vy+=this.gravity;this.x+=this.vx;this.y+=this.vy;this.rotation+=this.rotationSpeed;this.alpha-=.001}draw(){ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.rotation);ctx.globalAlpha=this.alpha;ctx.fillStyle=this.color;ctx.fillRect(-this.size/2,-this.size/2,this.size,this.size);ctx.restore();ctx.globalAlpha=1}}const confettiList=[];let confettiAnimationId;function shootConfetti(x,y){for(let i=0;i<35;i++){confettiList.push(new Confetti(x,y,Math.random()<.5?0:canvas.width))}}function animate(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;ctx.clearRect(0,0,canvas.width,canvas.height);for(let i=confettiList.length-1;i>=0;i--){const confetti=confettiList[i];confetti.update();confetti.draw();if(confetti.alpha<=0||confetti.y>canvas.height){confettiList.splice(i,1)}}confettiAnimationId=requestAnimationFrame(animate)}let animationIdBackground;const candle=document.querySelectorAll(".candle");const wick=document.querySelectorAll(".wick");const flame=document.querySelectorAll(".flame");async function startMic(){const stream=await navigator.mediaDevices.getUserMedia({audio:true});const audioContext=new(window.AudioContext||window.webkitAudioContext);const source=audioContext.createMediaStreamSource(stream);const analyser=audioContext.createAnalyser();let stopMic=false;analyser.fftSize=2048;const bufferLength=analyser.fftSize;const dataArray=new Uint8Array(bufferLength);source.connect(analyser);function detectBlow(){if(stopMic)return;analyser.getByteFrequencyData(dataArray);const average=dataArray.reduce((acc,val)=>acc+val,0)/bufferLength;const threshold=45;if(average>threshold){audio1.pause();audio2.play();wick.forEach((item,index)=>{item.hidden=true});flame.forEach(item=>item.hidden=true);animate();for(let i=0;i<15;i++){shootConfetti(0,0);shootConfetti(canvas.width,0);shootConfetti(0,canvas.height);shootConfetti(canvas.width,canvas.height)}candle.forEach(item=>{item.style.opacity=0;item.style.transition="opacity 3s"});setTimeout(()=>{clearInterval(confettiAnimationId);image.style.display="none";cake.style.transition="transform 3s";cake.style.transform="translateY(999px)";startDropText()},2e3);stopMic=true;cancelAnimationFrame(animationIdBackground)}}setInterval(detectBlow,0)}sliderImage();if(screenHeight<769){const imgTop=document.querySelector(".image-top");const imgBot=document.querySelector(".image-bot");imgTop.style.top="50%";imgBot.style.display="none";imgBot.style.scale="0.8"}playBtn.onclick=function(){banner.hidden=true;image.hidden=true;question.style.display="grid";window.addEventListener("resize",()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight})};let counterErrPass=0;function checkPassword(){const password=document.querySelector(".password");let isCountDownStart=false;if(password.value==="09102001"){cancelAnimationFrame(confettiAnimationId);animateCountDown(0);question.style.display="none"}else{switch(counterErrPass){case 0:Swal.fire({icon:"error",title:"Sai r·ªìi!!! üòíüòíüòí",text:"G·ª£i √Ω l·∫ßn 1: L√† nh·ªØng con s·ªë!"});break;case 1:Swal.fire({icon:"error",title:"Sai r·ªìi!!! üòíüòíüòí",text:"G·ª£i √Ω l·∫ßn 2: L√† ng√†y th√°ng!"});break;case 2:Swal.fire({icon:"error",title:"ƒê·ªì ngu!!! üòíüòíüòí",text:"L·∫ßn 3 a nh·∫Øc e. Qu√° tam l√†..."});break}counterErrPass++;if(counterErrPass>3){banner.hidden=false;question.hidden=true;counterErrPass=0}}}checkBtn.onclick=function(){checkPassword()};const fontSize=30;let columns;const dataCountDown=["you","love","i","and...","My Love ‚ù§Ô∏è","Birthday","Happy",0,1,2,3,4,5];let counter=dataCountDown.length-1;let lastCountdownTime=0;const countdownInterval=1e3;let numberDots=[];let particles=[];class Particle{constructor(x,y){this.x=x;this.y=y;const angle=Math.random()*Math.PI*2;const speed=Math.random()*1;this.vx=Math.cos(angle)*speed*5;this.vy=Math.sin(angle)*speed*5;this.friction=.97;this.life=isScreenPC?70+Math.random()*30:70+Math.random()*3;this.initialLife=this.life;this.alpha=1}update(){this.vx*=this.friction;this.vy*=this.friction;this.x+=this.vx;this.y+=this.vy;this.life--;this.alpha=Math.max(0,this.life/this.initialLife)}draw(ctx){ctx.fillStyle=`rgba(255, 0, 0, ${this.alpha})`;ctx.beginPath();isScreenPC?ctx.arc(this.x,this.y,4,0,Math.PI*2):ctx.arc(this.x,this.y,2,0,Math.PI*2);ctx.fill()}}function setupCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;columns=Math.floor(canvas.width/fontSize)}let backgroundYOffset=-window.innerHeight;let backgroundAnimationId;const matrixText="HAPPY BIRTHDAY";const fontSizeMatrix=24;let columnsMatrix;let drops=[];function setupMatrix(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;columnsMatrix=Math.floor(canvas.width/fontSizeMatrix);for(let i=0;i<columnsMatrix;i++){drops[i]=1+Math.random()*canvas.height}}function drawMatrix(){ctx.fillStyle="rgba(0, 0, 0, 0.05)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="pink";ctx.font=fontSizeMatrix+"px monospace";for(let i=0;i<drops.length;i++){const text=matrixText.charAt(Math.floor(Math.random()*matrixText.length));ctx.fillText(text,i*fontSizeMatrix,drops[i]*fontSizeMatrix);if(drops[i]*fontSizeMatrix>canvas.height&&Math.random()>.975){drops[i]=0}drops[i]++}}let checkOutMatrix=false;function animateMatrix(){if(checkOutMatrix)return;setupMatrix();intervalIdMatrix=setInterval(drawMatrix,80)}let matrixInterval;window.addEventListener("resize",setupMatrix);function generateNumberDots(content){numberDots=[];const tempCanvas=document.createElement("canvas");const tempCtx=tempCanvas.getContext("2d");tempCanvas.width=canvas.width;tempCanvas.height=canvas.height;let fontStyle=typeof content==="string"&&content.length>4?"bold 200px Arial":"bold 250px Arial";if(!isScreenPC){fontStyle=typeof content==="string"&&content.length>6?"bold 70px Arial":"bold 100px Arial"}tempCtx.font=fontStyle;tempCtx.fillStyle="white";tempCtx.textAlign="center";tempCtx.textBaseline="middle";tempCtx.fillText(content,canvas.width/2,canvas.height/2);const imageData=tempCtx.getImageData(0,0,canvas.width,canvas.height).data;const gap=isScreenPC?6:3;for(let y=0;y<canvas.height;y+=gap){for(let x=0;x<canvas.width;x+=gap){const alphaIndex=(y*canvas.width+x)*4+3;if(imageData[alphaIndex]>128){numberDots.push({x:x,y:y})}}}}function drawCurrentNumber(){ctx.fillStyle="red";const dotSize=isScreenPC?3:1.5;numberDots.forEach(dot=>{ctx.beginPath();ctx.arc(dot.x,dot.y,dotSize,0,Math.PI*2);ctx.fill()})}function updateAndDrawParticles(){for(let i=particles.length-1;i>=0;i--){const p=particles[i];p.update();p.draw(ctx);if(p.life<=0){particles.splice(i,1)}}}let animationId;let checkOut=false;function animateCountDown(currentTime){if(checkOut){cancelAnimationFrame(animationId);audio1.play();animateMatrix();setTimeout(()=>{cake.classList.add("show")},500);return}ctx.fillStyle="black";ctx.fillRect(0,0,canvas.width,canvas.height);updateAndDrawParticles();if(currentTime-lastCountdownTime>countdownInterval){lastCountdownTime=currentTime;setupCanvas();if(counter>=0){numberDots.forEach(dot=>{particles.push(new Particle(dot.x,dot.y))});counter--;if(counter>=0){generateNumberDots(dataCountDown[counter])}else{numberDots=[]}}else if(counter<0){const music=document.querySelector("#audio");startMic();cancelAnimationFrame(animationId);checkOut=true}}drawCurrentNumber();animationId=requestAnimationFrame(animateCountDown)}